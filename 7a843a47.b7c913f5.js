(window.webpackJsonp=window.webpackJsonp||[]).push([[49],{105:function(e,t,n){"use strict";n.r(t),n.d(t,"frontMatter",(function(){return s})),n.d(t,"metadata",(function(){return u})),n.d(t,"rightToc",(function(){return l})),n.d(t,"default",(function(){return p}));var a=n(2),r=n(6),o=(n(0),n(156)),i=n(163),c=n(164),s={title:"Authentication Alerts",description:"Alerts - Authentication",sidebar_label:"Authentication"},u={unversionedId:"alerts_authentication",id:"alerts_authentication",isDocsHomePage:!1,title:"Authentication Alerts",description:"Alerts - Authentication",source:"@site/docs/alerts_authentication.md",permalink:"/docs/docs/alerts_authentication",editUrl:"https://github.com/Leaf-Agriculture/docs/tree/master/docs/alerts_authentication.md",sidebar_label:"Authentication",sidebar:"docs",previous:{title:"List of Events",permalink:"/docs/docs/alerts_events"},next:{title:"Leaf User Overview",permalink:"/docs/docs/user_management_overview"}},l=[],d={rightToc:l};function p(e){var t=e.components,n=Object(r.a)(e,["components"]);return Object(o.b)("wrapper",Object(a.a)({},d,n,{components:t,mdxType:"MDXLayout"}),Object(o.b)("p",null,"It\u2019s very important to confirm that requests received on your webhook are sent from Leaf, to avoid IP spoofing attacks.\nTo this end, you should verify webhook signatures."),Object(o.b)("p",null,"Leaf generates signatures using a hash-based message authentication code (HMAC) with SHA-256, and\nthe secret specified when you created the alerts' configuration as the HMAC key.\nBe careful with deserialization of the request body when using it to verify the signature.\nIt's recommended that you get the request body as bytes. The signed content has no line breaks and spaces after symbols, it's a string of the raw JSON with white-spaces after \u201c:\u201d and \u201c,\u201d."),Object(o.b)("p",null,"The digest is added to the X-Leaf-Signature header encoded in base 64."),Object(o.b)("p",null,"Here is an example on how to verify the request in your webhook:"),Object(o.b)(i.a,{defaultValue:"py",values:[{label:"Python",value:"py"},{label:"Java",value:"java"}],mdxType:"Tabs"},Object(o.b)(c.a,{value:"py",mdxType:"TabItem"},Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{className:"language-py"}),"import hmac\nimport base64\nimport json\n\npayload = 'alert_payload'\n\n# Sign the request body received with your secret\nexpected_sig = hmac.digest(msg=bytes(json.dumps(payload), 'utf-8'),\n                           key=bytes('your secret key', 'utf-8'),\n                           digest='sha256')\n\n# Decode the base-64 encoded X-Leaf-Signature header that was sent in the event header\nsig_header = \"x-leaf-signature-in-header\"\nrequest_sig = base64.b64decode(sig_header)\n\n# Compare both\nhmac.compare_digest(expected_sig, request_sig)\n"))),Object(o.b)(c.a,{value:"java",mdxType:"TabItem"},Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{className:"language-java"}),'// import java.util.Base64;\n// import javax.crypto.Mac;\n// import javax.crypto.spec.SecretKeySpec;\n\nbyte[] sigHeader;  // Get from the request headers\nbyte[] rawContent;  // Get the request body\n\nString hmacAlgorithm = "HmacSHA256";\nMac mac = Mac.getInstance("HmacSHA256");\nmac.init(new SecretKeySpec("your secret".getBytes(), hmacAlgorithm));\nbyte[] signatureBytes = mac.doFinal(rawContent);\n\n// Compare sigHeader with signatureBytes\nMessageDigest.isEqual(sigHeader, signatureBytes)\n')))),Object(o.b)("p",null,"The value ",Object(o.b)("inlineCode",{parentName:"p"},"alert_payload")," corresponds to the payload of the ",Object(o.b)("a",Object(a.a)({parentName:"p"},{href:"https://docs.withleaf.io/docs/alerts_events/#about"}),"alerts"),"."),Object(o.b)("p",null,"For example, if you need to authenticate a created field, the ",Object(o.b)("inlineCode",{parentName:"p"},"alert_payload")," will be:"),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{className:"language-json"}),'{\n  "source": "REST",\n  "leafUserId": "the id of the file owner",\n  "fieldId": "the id of the created field",\n  "timestamp": "yyyy-MM-dd\'T\'HH:mm:ss.SSSSSS\'Z\'",\n  "type": "fieldCreated"\n}\n')))}p.isMDXComponent=!0},156:function(e,t,n){"use strict";n.d(t,"a",(function(){return d})),n.d(t,"b",(function(){return b}));var a=n(0),r=n.n(a);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function c(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var u=r.a.createContext({}),l=function(e){var t=r.a.useContext(u),n=t;return e&&(n="function"==typeof e?e(t):c(c({},t),e)),n},d=function(e){var t=l(e.components);return r.a.createElement(u.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return r.a.createElement(r.a.Fragment,{},t)}},f=r.a.forwardRef((function(e,t){var n=e.components,a=e.mdxType,o=e.originalType,i=e.parentName,u=s(e,["components","mdxType","originalType","parentName"]),d=l(n),f=a,b=d["".concat(i,".").concat(f)]||d[f]||p[f]||o;return n?r.a.createElement(b,c(c({ref:t},u),{},{components:n})):r.a.createElement(b,c({ref:t},u))}));function b(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var o=n.length,i=new Array(o);i[0]=f;var c={};for(var s in t)hasOwnProperty.call(t,s)&&(c[s]=t[s]);c.originalType=e,c.mdxType="string"==typeof e?e:a,i[1]=c;for(var u=2;u<o;u++)i[u]=n[u];return r.a.createElement.apply(null,i)}return r.a.createElement.apply(null,n)}f.displayName="MDXCreateElement"},158:function(e,t,n){"use strict";function a(e){var t,n,r="";if("string"==typeof e||"number"==typeof e)r+=e;else if("object"==typeof e)if(Array.isArray(e))for(t=0;t<e.length;t++)e[t]&&(n=a(e[t]))&&(r&&(r+=" "),r+=n);else for(t in e)e[t]&&(r&&(r+=" "),r+=t);return r}t.a=function(){for(var e,t,n=0,r="";n<arguments.length;)(e=arguments[n++])&&(t=a(e))&&(r&&(r+=" "),r+=t);return r}},161:function(e,t,n){"use strict";var a=n(0),r=Object(a.createContext)(void 0);t.a=r},162:function(e,t,n){"use strict";var a=n(0),r=n(161);t.a=function(){var e=Object(a.useContext)(r.a);if(null==e)throw new Error("`useUserPreferencesContext` is used outside of `Layout` Component.");return e}},163:function(e,t,n){"use strict";var a=n(0),r=n.n(a),o=n(162),i=n(158),c=n(48),s=n.n(c),u=37,l=39;t.a=function(e){var t=e.block,n=e.children,c=e.defaultValue,d=e.values,p=e.groupId,f=Object(o.a)(),b=f.tabGroupChoices,m=f.setTabGroupChoices,y=Object(a.useState)(c),h=y[0],g=y[1],v=Object(a.useState)(!1),O=v[0],j=v[1];if(null!=p){var w=b[p];null!=w&&w!==h&&d.some((function(e){return e.value===w}))&&g(w)}var x=function(e){g(e),null!=p&&m(p,e)},S=[],_=function(e){e.metaKey||e.altKey||e.ctrlKey||j(!0)},C=function(){j(!1)};return Object(a.useEffect)((function(){window.addEventListener("keydown",_),window.addEventListener("mousedown",C)}),[]),r.a.createElement("div",null,r.a.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:Object(i.a)("tabs",{"tabs--block":t})},d.map((function(e){var t=e.value,n=e.label;return r.a.createElement("li",{role:"tab",tabIndex:0,"aria-selected":h===t,className:Object(i.a)("tabs__item",s.a.tabItem,{"tabs__item--active":h===t}),style:O?{}:{outline:"none"},key:t,ref:function(e){return S.push(e)},onKeyDown:function(e){!function(e,t,n){switch(n.keyCode){case l:!function(e,t){var n=e.indexOf(t)+1;e[n]?e[n].focus():e[0].focus()}(e,t);break;case u:!function(e,t){var n=e.indexOf(t)-1;e[n]?e[n].focus():e[e.length-1].focus()}(e,t)}}(S,e.target,e),_(e)},onFocus:function(){return x(t)},onClick:function(){x(t),j(!1)},onPointerDown:function(){return j(!1)}},n)}))),r.a.createElement("div",{role:"tabpanel",className:"margin-vert--md"},a.Children.toArray(n).filter((function(e){return e.props.value===h}))[0]))}},164:function(e,t,n){"use strict";var a=n(0),r=n.n(a);t.a=function(e){return r.a.createElement("div",null,e.children)}}}]);