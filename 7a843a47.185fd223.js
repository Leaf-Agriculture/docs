(window.webpackJsonp=window.webpackJsonp||[]).push([[50],{106:function(e,t,n){"use strict";n.r(t),n.d(t,"frontMatter",(function(){return c})),n.d(t,"metadata",(function(){return u})),n.d(t,"rightToc",(function(){return l})),n.d(t,"default",(function(){return b}));var a=n(2),r=n(6),o=(n(0),n(158)),i=n(165),s=n(166),c={title:"Alert Authentication and Security",description:"Alerts - Authentication and Security",sidebar_label:"Authentication and Security"},u={unversionedId:"alerts_authentication",id:"alerts_authentication",isDocsHomePage:!1,title:"Alert Authentication and Security",description:"Alerts - Authentication and Security",source:"@site/docs/alerts_authentication.md",permalink:"/docs/docs/alerts_authentication",editUrl:"https://github.com/Leaf-Agriculture/docs/tree/master/docs/alerts_authentication.md",sidebar_label:"Authentication and Security",sidebar:"docs",previous:{title:"List of Events",permalink:"/docs/docs/alerts_events"},next:{title:"Leaf User Overview",permalink:"/docs/docs/user_management_overview"}},l=[{value:"Validating Signatures from Leaf",id:"validating-signatures-from-leaf",children:[]},{value:"Webhooks and IP Addresses",id:"webhooks-and-ip-addresses",children:[]}],d={rightToc:l};function b(e){var t=e.components,n=Object(r.a)(e,["components"]);return Object(o.b)("wrapper",Object(a.a)({},d,n,{components:t,mdxType:"MDXLayout"}),Object(o.b)("h2",{id:"validating-signatures-from-leaf"},"Validating Signatures from Leaf"),Object(o.b)("p",null,"Keeping your webhook secure is essential to ensure that only Leaf sends requests to your endpoint. To help with this, Leaf uses signatures to verify every request."),Object(o.b)("p",null,"Here\u2019s how it works:"),Object(o.b)("ul",null,Object(o.b)("li",{parentName:"ul"},Object(o.b)("p",{parentName:"li"},"Signatures and Secrets: Each webhook request is signed using HMAC with SHA-256. The secret key you set up during the alert\u2019s configuration is used to generate the signature.")),Object(o.b)("li",{parentName:"ul"},Object(o.b)("p",{parentName:"li"},"What You Should Do: Use the X-Leaf-Signature header in the request to verify the signature. This ensures the request is genuine and untampered. The digest added to the X-Leaf-Signature header is encoded in base 64.")),Object(o.b)("li",{parentName:"ul"},Object(o.b)("p",{parentName:"li"},'Handling the Request Body: Always read the request body as raw bytes before verifying the signature. The signed content is a compact JSON string without extra line breaks or spaces (other than spaces after ":" and ",").'))),Object(o.b)("p",null,"By following these steps, you\u2019ll ensure that your application only processes requests sent by Leaf."),Object(o.b)("div",{className:"admonition admonition-info alert alert--info"},Object(o.b)("div",Object(a.a)({parentName:"div"},{className:"admonition-heading"}),Object(o.b)("h5",{parentName:"div"},Object(o.b)("span",Object(a.a)({parentName:"h5"},{className:"admonition-icon"}),Object(o.b)("svg",Object(a.a)({parentName:"span"},{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"}),Object(o.b)("path",Object(a.a)({parentName:"svg"},{fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"})))),"info")),Object(o.b)("div",Object(a.a)({parentName:"div"},{className:"admonition-content"}),Object(o.b)("p",{parentName:"div"},"Using an ",Object(o.b)("inlineCode",{parentName:"p"},"X-CompanyName-Signature")," header is a common method of securing webhooks and is used by many companies including ",Object(o.b)("a",Object(a.a)({parentName:"p"},{href:"https://www.twilio.com/docs/usage/webhooks/webhooks-security"}),"Twilio")," and ",Object(o.b)("a",Object(a.a)({parentName:"p"},{href:"https://api.slack.com/authentication/verifying-requests-from-slack"}),"Slack"),". "))),Object(o.b)("p",null,"Here is an example on how to verify the request in your webhook:"),Object(o.b)(i.a,{defaultValue:"py",values:[{label:"Python",value:"py"},{label:"Java",value:"java"}],mdxType:"Tabs"},Object(o.b)(s.a,{value:"py",mdxType:"TabItem"},Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{className:"language-py"}),"import hmac\nimport base64\nimport json\n\npayload = 'alert_payload'\n\n# Sign the request body received with your secret\nexpected_sig = hmac.digest(msg=bytes(json.dumps(payload), 'utf-8'),\n                           key=bytes('your secret key', 'utf-8'),\n                           digest='sha256')\n\n# Decode the base-64 encoded X-Leaf-Signature header that was sent in the event header\nsig_header = \"x-leaf-signature-in-header\"\nrequest_sig = base64.b64decode(sig_header)\n\n# Compare both\nhmac.compare_digest(expected_sig, request_sig)\n"))),Object(o.b)(s.a,{value:"java",mdxType:"TabItem"},Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{className:"language-java"}),'// import java.util.Base64;\n// import javax.crypto.Mac;\n// import javax.crypto.spec.SecretKeySpec;\n\nbyte[] sigHeader;  // Get from the request headers\nbyte[] rawContent;  // Get the request body\n\nString hmacAlgorithm = "HmacSHA256";\nMac mac = Mac.getInstance("HmacSHA256");\nmac.init(new SecretKeySpec("your secret".getBytes(), hmacAlgorithm));\nbyte[] signatureBytes = mac.doFinal(rawContent);\n\n// Compare sigHeader with signatureBytes\nMessageDigest.isEqual(sigHeader, signatureBytes)\n')))),Object(o.b)("p",null,"The value ",Object(o.b)("inlineCode",{parentName:"p"},"alert_payload")," corresponds to the payload of the ",Object(o.b)("a",Object(a.a)({parentName:"p"},{href:"https://docs.withleaf.io/docs/alerts_events/#about"}),"alerts"),"."),Object(o.b)("p",null,"For example, if you need to authenticate a created field, the ",Object(o.b)("inlineCode",{parentName:"p"},"alert_payload")," will be:"),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{className:"language-json"}),'{\n  "source": "REST",\n  "leafUserId": "the id of the file owner",\n  "fieldId": "the id of the created field",\n  "timestamp": "yyyy-MM-dd\'T\'HH:mm:ss.SSSSSS\'Z\'",\n  "type": "fieldCreated"\n}\n')),Object(o.b)("h2",{id:"webhooks-and-ip-addresses"},"Webhooks and IP Addresses"),Object(o.b)("p",null,"Leaf uses a cloud architecture to provide services, and as such, does not have a fixed range of IP addresses that issue webhooks."),Object(o.b)("p",null,"When designing your network architecture, you may wish to have one set of servers and a load balancer in a DMZ that receive webhook requests from Leaf, and then proxy those requests to your private network."))}b.isMDXComponent=!0},158:function(e,t,n){"use strict";n.d(t,"a",(function(){return d})),n.d(t,"b",(function(){return f}));var a=n(0),r=n.n(a);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function c(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var u=r.a.createContext({}),l=function(e){var t=r.a.useContext(u),n=t;return e&&(n="function"==typeof e?e(t):s(s({},t),e)),n},d=function(e){var t=l(e.components);return r.a.createElement(u.Provider,{value:t},e.children)},b={inlineCode:"code",wrapper:function(e){var t=e.children;return r.a.createElement(r.a.Fragment,{},t)}},p=r.a.forwardRef((function(e,t){var n=e.components,a=e.mdxType,o=e.originalType,i=e.parentName,u=c(e,["components","mdxType","originalType","parentName"]),d=l(n),p=a,f=d["".concat(i,".").concat(p)]||d[p]||b[p]||o;return n?r.a.createElement(f,s(s({ref:t},u),{},{components:n})):r.a.createElement(f,s({ref:t},u))}));function f(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var o=n.length,i=new Array(o);i[0]=p;var s={};for(var c in t)hasOwnProperty.call(t,c)&&(s[c]=t[c]);s.originalType=e,s.mdxType="string"==typeof e?e:a,i[1]=s;for(var u=2;u<o;u++)i[u]=n[u];return r.a.createElement.apply(null,i)}return r.a.createElement.apply(null,n)}p.displayName="MDXCreateElement"},160:function(e,t,n){"use strict";function a(e){var t,n,r="";if("string"==typeof e||"number"==typeof e)r+=e;else if("object"==typeof e)if(Array.isArray(e))for(t=0;t<e.length;t++)e[t]&&(n=a(e[t]))&&(r&&(r+=" "),r+=n);else for(t in e)e[t]&&(r&&(r+=" "),r+=t);return r}t.a=function(){for(var e,t,n=0,r="";n<arguments.length;)(e=arguments[n++])&&(t=a(e))&&(r&&(r+=" "),r+=t);return r}},163:function(e,t,n){"use strict";var a=n(0),r=Object(a.createContext)(void 0);t.a=r},164:function(e,t,n){"use strict";var a=n(0),r=n(163);t.a=function(){var e=Object(a.useContext)(r.a);if(null==e)throw new Error("`useUserPreferencesContext` is used outside of `Layout` Component.");return e}},165:function(e,t,n){"use strict";var a=n(0),r=n.n(a),o=n(164),i=n(160),s=n(48),c=n.n(s),u=37,l=39;t.a=function(e){var t=e.block,n=e.children,s=e.defaultValue,d=e.values,b=e.groupId,p=Object(o.a)(),f=p.tabGroupChoices,m=p.setTabGroupChoices,h=Object(a.useState)(s),y=h[0],g=h[1],v=Object(a.useState)(!1),O=v[0],j=v[1];if(null!=b){var w=f[b];null!=w&&w!==y&&d.some((function(e){return e.value===w}))&&g(w)}var S=function(e){g(e),null!=b&&m(b,e)},N=[],k=function(e){e.metaKey||e.altKey||e.ctrlKey||j(!0)},x=function(){j(!1)};return Object(a.useEffect)((function(){window.addEventListener("keydown",k),window.addEventListener("mousedown",x)}),[]),r.a.createElement("div",null,r.a.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:Object(i.a)("tabs",{"tabs--block":t})},d.map((function(e){var t=e.value,n=e.label;return r.a.createElement("li",{role:"tab",tabIndex:0,"aria-selected":y===t,className:Object(i.a)("tabs__item",c.a.tabItem,{"tabs__item--active":y===t}),style:O?{}:{outline:"none"},key:t,ref:function(e){return N.push(e)},onKeyDown:function(e){!function(e,t,n){switch(n.keyCode){case l:!function(e,t){var n=e.indexOf(t)+1;e[n]?e[n].focus():e[0].focus()}(e,t);break;case u:!function(e,t){var n=e.indexOf(t)-1;e[n]?e[n].focus():e[e.length-1].focus()}(e,t)}}(N,e.target,e),k(e)},onFocus:function(){return S(t)},onClick:function(){S(t),j(!1)},onPointerDown:function(){return j(!1)}},n)}))),r.a.createElement("div",{role:"tabpanel",className:"margin-vert--md"},a.Children.toArray(n).filter((function(e){return e.props.value===y}))[0]))}},166:function(e,t,n){"use strict";var a=n(0),r=n.n(a);t.a=function(e){return r.a.createElement("div",null,e.children)}}}]);